<!DOCTYPE html>
<html>
<head>
  <title>Anime Video Player</title>
  <style>
    /* Base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      background-color: #2E0854;
      color: white;
      min-height: 100vh;
      overflow: hidden;
      transition: background 0.5s ease;
    }
    
    /* Background image option */
    body.bg-image {
      background-image: url('https://images.unsplash.com/photo-1578584099737-2a23864cad11?q=80&w=1920&auto=format&fit=crop');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    
    body.bg-image::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(46, 8, 84, 0.85);
      z-index: 0;
    }
    
    /* Main container */
    .container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    
    /* Titles */
    .title {
      color: #FFFFFF;
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 10px #FF00FF, 0 0 20px #FF00FF, 0 0 40px #FF00FF;
      animation: textFlicker 2s infinite;
    }
    
    .subtitle {
      color: #FFFFFF;
      font-size: 1.5rem;
      margin-bottom: 2rem;
      text-shadow: 0 0 5px #FF00FF, 0 0 10px #FF00FF;
    }
    
    /* Video player */
    .video-wrapper {
      position: relative;
      width: 90%;
      max-width: 800px;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #FF00FF;
      box-shadow: 0 0 30px #FF00FF, 0 0 60px rgba(255, 0, 255, 0.5);
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 2;
    }
    
    video {
      display: block;
      width: 100%;
      height: auto;
    }
    
    .controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
    }
    
    .control-button {
      background: linear-gradient(135deg, #FF00FF 0%, #9400D3 100%);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
      box-shadow: 0 0 8px rgba(255, 0, 255, 0.5);
      text-shadow: 0 0 3px #000;
    }
    
    .control-button:hover {
      background: linear-gradient(135deg, #FF00FF 20%, #9400D3 80%);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 0, 255, 0.7);
    }
    
    .control-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(255, 0, 255, 0.5);
    }
    
    .progress {
      flex-grow: 1;
      height: 4px;
      background-color: rgba(255, 255, 255, 0.2);
      position: relative;
      margin: 0 1rem;
      cursor: pointer;
    }
    
    .progress-bar {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background-color: #FF00FF;
      width: 0%;
    }

    .timestamp-marker {
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: #00FFFF;
      border-radius: 50%;
      top: -2px;
      transform: translateX(-50%);
      cursor: pointer;
      box-shadow: 0 0 5px #00FFFF;
      z-index: 2;
    }
    
    .volume-container {
      display: flex;
      align-items: center;
      margin-right: 10px;
    }
    
    .volume-slider {
      width: 80px;
      margin: 0 10px;
      -webkit-appearance: none;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
    }
    
    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #FF00FF;
      cursor: pointer;
      box-shadow: 0 0 5px #FF00FF;
    }
    
    .speed-select {
      background: rgba(255, 0, 255, 0.2);
      border: 1px solid #FF00FF;
      color: white;
      padding: 0.4rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      margin-right: 10px;
    }
    
    .speed-select option {
      background-color: #2E0854;
    }

    .control-row {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    /* Magic Circles */
    .magic-circles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      z-index: 1;
    }
    
    .circle {
      position: absolute;
      border-radius: 50%;
      border: 2px solid #FF00FF;
      box-shadow: 0 0 20px #FF00FF;
      opacity: 0.2;
    }
    
    .circle:nth-child(1) {
      width: 500px;
      height: 500px;
      animation: spin 15s linear infinite;
    }
    
    .circle:nth-child(2) {
      width: 400px;
      height: 400px;
      animation: spin 20s linear infinite reverse;
    }
    
    .circle:nth-child(3) {
      width: 300px;
      height: 300px;
      animation: spin 25s linear infinite;
    }
    
    /* Hexagram */
    .hexagram {
      position: absolute;
      width: 300px;
      height: 300px;
      background-image: url("data:image/svg+xml,%3Csvg width='300' height='300' viewBox='0 0 300 300' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M150 0 L225 130 L300 150 L225 170 L150 300 L75 170 L0 150 L75 130 Z' stroke='%23FF00FF' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      opacity: 0.4;
      animation: spin 20s linear infinite;
    }
    
    /* Floating kanji */
    .kanji-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    
    .kanji {
      position: absolute;
      font-size: 5rem;
      font-weight: bold;
      color: #FFA500;
      opacity: 0.5;
      text-shadow: 
        0 0 8px #ff9800,
        0 0 15px #ff5722,
        0 0 20px #f44336,
        0 0 30px #e91e63;
      animation-name: float;
      animation-duration: 5s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }
    
    .kanji::after {
      content: '';
      position: absolute;
      top: -30%;
      left: -30%;
      right: -30%;
      bottom: -30%;
      background: radial-gradient(
        ellipse at center, 
        rgba(255,152,0,0.8) 0%, 
        rgba(255,87,34,0.5) 50%, 
        rgba(244,67,54,0) 100%
      );
      filter: blur(8px);
      z-index: -1;
      animation: fireGlow 2s infinite alternate;
      border-radius: 40%;
    }
    
    .kanji-anime {
      position: absolute;
      font-size: 3.5rem;
      font-weight: bold;
      color: #FF00FF;
      opacity: 0.7;
      text-shadow: 0 0 10px #FF00FF, 0 0 20px #FF00FF, 0 0 30px #FF00FF;
      animation: floatDramatic 8s ease-in-out infinite;
    }
    
    .kanji-anime::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      right: -50%;
      bottom: -50%;
      background: radial-gradient(
        ellipse at center,
        rgba(255,0,255,0.7) 0%, 
        rgba(128,0,128,0.4) 50%, 
        rgba(64,0,64,0) 100%
      );
      filter: blur(12px);
      z-index: -1;
      animation: textFlicker 2s infinite;
      border-radius: 50%;
    }

    @keyframes fireGlow {
      0% { opacity: 0.7; filter: blur(8px) brightness(1); }
      50% { opacity: 0.9; filter: blur(12px) brightness(1.3); }
      100% { opacity: 0.7; filter: blur(8px) brightness(1); }
    }

    @keyframes textFlicker {
      0%, 100% { opacity: 0.8; text-shadow: 0 0 10px #FF00FF, 0 0 20px #FF00FF, 0 0 30px #FF00FF; }
      25% { opacity: 0.6; text-shadow: 0 0 5px #FF00FF, 0 0 10px #FF00FF; }
      50% { opacity: 1; text-shadow: 0 0 15px #FF00FF, 0 0 30px #FF00FF, 0 0 45px #FF00FF; }
      75% { opacity: 0.7; text-shadow: 0 0 8px #FF00FF, 0 0 15px #FF00FF; }
    }
    
    @keyframes intenseFire {
      0% {
        text-shadow: 
          0 0 4px #ff9800,
          0 0 10px #ff5722,
          0 0 15px #f44336;
        transform: translateY(0) scale(1) rotate(-1deg);
      }
      25% {
        text-shadow: 
          0 0 8px #ff9800,
          0 0 15px #ff5722,
          0 0 22px #f44336,
          0 0 30px #e91e63;
        transform: translateY(-5px) scale(1.08) rotate(1deg);
      }
      50% {
        text-shadow: 
          0 0 6px #ff9800,
          0 0 12px #ff5722,
          0 0 18px #f44336,
          0 0 25px #e91e63;
        transform: translateY(-3px) scale(1.03) rotate(0deg);
      }
      75% {
        text-shadow: 
          0 0 9px #ff9800,
          0 0 18px #ff5722,
          0 0 28px #f44336,
          0 0 35px #e91e63;
        transform: translateY(-6px) scale(1.1) rotate(2deg);
      }
    }
    
    @keyframes floatDramatic {
      0% { transform: translate(0, 0) rotate(-5deg); }
      25% { transform: translate(20px, -40px) rotate(10deg); }
      50% { transform: translate(0, -60px) rotate(0deg); }
      75% { transform: translate(-20px, -40px) rotate(-10deg); }
      100% { transform: translate(0, 0) rotate(5deg); }
    }
    
    /* Sakura petals */
    .sakura-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
    }
    
    .sakura {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 100% 0 100% 0;
      background: #FFB7C5;
      box-shadow: 0 0 8px #FFB7C5;
      animation-name: sakuraFall;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }
    
    /* Energy blasts */
    .energy-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .energy-blast {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,0,255,0.4) 0%, rgba(255,0,255,0) 70%);
      transform: scale(0);
      opacity: 0;
      animation: energyBlast 4s infinite;
    }

    /* Comments section */
    .comments-container {
      width: 90%;
      max-width: 800px;
      margin-top: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      padding: 15px;
      border: 2px solid #FF00FF;
      box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
    }

    .comments-title {
      font-size: 1.5rem;
      margin-bottom: 15px;
      text-shadow: 0 0 5px #FF00FF;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .comment-form {
      display: flex;
      margin-bottom: 15px;
      gap: 10px;
    }

    .comment-input {
      flex-grow: 1;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #FF00FF;
      padding: 8px 12px;
      border-radius: 4px;
      color: white;
      outline: none;
    }

    .comment-input:focus {
      box-shadow: 0 0 8px #FF00FF;
    }

    .comment-list {
      max-height: 200px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .comment-item {
      padding: 10px;
      margin-bottom: 10px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      border-left: 3px solid #FF00FF;
    }

    .comment-timestamp {
      color: #00FFFF;
      cursor: pointer;
      margin-right: 10px;
      font-weight: bold;
    }

    .comment-timestamp:hover {
      text-decoration: underline;
    }

    /* Loading animation */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #2E0854;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.5s ease-out;
    }

    .loading-circle {
      width: 100px;
      height: 100px;
      border: 4px solid rgba(255, 0, 255, 0.3);
      border-top: 4px solid #FF00FF;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    .loading-text {
      font-size: 1.5rem;
      color: white;
      text-shadow: 0 0 10px #FF00FF;
      animation: textFlicker 1.5s infinite;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: #FF00FF;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #cc00cc;
    }
    
    /* Animations */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(10deg); }
      50% { transform: translateY(-20px) rotate(0deg); }
    }
    
    @keyframes sakuraFall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0.8;
      }
      10% { opacity: 1; }
      90% { opacity: 0.8; }
      100% {
        transform: translateY(1000px) rotate(720deg);
        opacity: 0;
      }
    }
    
    @keyframes energyBlast {
      0% { transform: scale(0); opacity: 0; }
      20% { transform: scale(1); opacity: 0.7; }
      100% { transform: scale(3); opacity: 0; }
    }
    
    @keyframes textFlicker {
      0%, 100% { text-shadow: 0 0 10px #FF00FF, 0 0 20px #FF00FF, 0 0 40px #FF00FF; }
      50% { text-shadow: 0 0 5px #FF00FF, 0 0 10px #FF00FF, 0 0 20px #FF00FF; }
    }

    @keyframes glowPulse {
      0%, 100% { filter: drop-shadow(0 0 8px #FF00FF); }
      50% { filter: drop-shadow(0 0 15px #FF00FF); }
    }

    /* Pulsing background effect */
    .video-pulse {
      position: absolute;
      width: 100%;
      max-width: 840px;
      height: 100%;
      border-radius: 16px;
      background: radial-gradient(circle, rgba(255, 0, 255, 0.3) 0%, rgba(255, 0, 255, 0) 70%);
      z-index: 1;
      animation: pulse 3s infinite;
      filter: blur(10px);
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.05); opacity: 0.7; }
    }

    /* Mini-map for video navigation */
    .mini-map {
      width: 90%;
      max-width: 800px;
      height: 40px;
      margin-top: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      padding: 5px;
      border: 2px solid #FF00FF;
      box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
      position: relative;
      overflow: hidden;
    }

    .mini-map-progress {
      position: absolute;
      height: 100%;
      top: 0;
      left: 0;
      width: 0%;
      background-color: rgba(255, 0, 255, 0.3);
      pointer-events: none;
    }

    .mini-map-thumbnail {
      position: absolute;
      height: 60px;
      width: 80px;
      border: 2px solid #FF00FF;
      border-radius: 4px;
      background-color: black;
      bottom: 45px;
      transform: translateX(-50%);
      display: none;
      z-index: 10;
    }

    .mini-map-sections {
      display: flex;
      height: 100%;
      width: 100%;
    }

    .mini-map-section {
      height: 100%;
      flex-grow: 1;
      border-right: 1px solid rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .mini-map-section:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .mini-map-section:last-child {
      border-right: none;
    }

    /* Settings panel */
    .settings-button {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 0, 255, 0.2);
      border: 1px solid #FF00FF;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
      z-index: 100;
      transition: all 0.3s ease;
    }
    
    .settings-button:hover {
      background: rgba(255, 0, 255, 0.4);
      transform: rotate(30deg);
    }
    
    .settings-panel {
      position: fixed;
      top: 70px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #FF00FF;
      border-radius: 8px;
      padding: 15px;
      width: 250px;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
      z-index: 100;
      transform: translateX(300px);
      transition: transform 0.3s ease;
    }
    
    .settings-panel.visible {
      transform: translateX(0);
    }
    
    .settings-title {
      font-size: 1.2rem;
      margin-bottom: 15px;
      text-align: center;
      text-shadow: 0 0 5px #FF00FF;
    }
    
    .settings-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.2);
      transition: .4s;
      border-radius: 24px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: #FF00FF;
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    /* Keyboard shortcuts tooltip */
    .keyboard-shortcuts {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #FF00FF;
      border-radius: 8px;
      padding: 15px;
      width: 250px;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
      z-index: 100;
      transform: translateX(-300px);
      transition: transform 0.3s ease;
    }
    
    .keyboard-shortcuts.visible {
      transform: translateX(0);
    }
    
    .keyboard-title {
      font-size: 1.2rem;
      margin-bottom: 15px;
      text-align: center;
      text-shadow: 0 0 5px #FF00FF;
    }
    
    .keyboard-list {
      list-style-type: none;
      padding: 0;
    }
    
    .keyboard-list li {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .key {
      background: rgba(255, 0, 255, 0.2);
      border: 1px solid #FF00FF;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: monospace;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-circle"></div>
    <div class="loading-text">ロード中...</div>
  </div>

  <!-- Settings Button and Panel -->
  <div class="settings-button" id="settingsButton">⚙️</div>
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-title">設定 (Settings)</div>
    <div class="settings-option">
      <span>Background Image</span>
      <label class="toggle-switch">
        <input type="checkbox" id="bgToggle">
        <span class="toggle-slider"></span>
      </label>
    </div>
    <div class="settings-option">
      <span>Auto-play</span>
      <label class="toggle-switch">
        <input type="checkbox" id="autoplayToggle">
        <span class="toggle-slider"></span>
      </label>
    </div>
  </div>

  <!-- Keyboard Shortcuts -->
  <div class="keyboard-shortcuts" id="keyboardShortcuts">
    <div class="keyboard-title">キーボードショートカット</div>
    <ul class="keyboard-list">
      <li><span class="key">Space</span> <span>Play/Pause</span></li>
      <li><span class="key">F</span> <span>Fullscreen</span></li>
      <li><span class="key">M</span> <span>Mute/Unmute</span></li>
      <li><span class="key">←</span> <span>Rewind 10s</span></li>
      <li><span class="key">→</span> <span>Forward 10s</span></li>
      <li><span class="key">↑</span> <span>Volume Up</span></li>
      <li><span class="key">↓</span> <span>Volume Down</span></li>
      <li><span class="key">K</span> <span>Show/Hide Shortcuts</span></li>
    </ul>
  </div>

  <!-- Magic Circles -->
  <div class="magic-circles">
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="hexagram"></div>
  </div>
  
  <!-- Floating Kanji -->
  <div class="kanji-container" id="kanjiContainer"></div>
  
  <!-- Sakura Petals -->
  <div class="sakura-container" id="sakuraContainer"></div>
  
  <!-- Energy Blasts -->
  <div class="energy-container">
    <div class="energy-blast" style="animation-delay: 0s;"></div>
    <div class="energy-blast" style="animation-delay: 1s;"></div>
    <div class="energy-blast" style="animation-delay: 2s;"></div>
    <div class="energy-blast" style="animation-delay: 3s;"></div>
  </div>
  
  <!-- Main Content -->
  <div class="container">
    <h1 class="title">インタラクティブビデオプレーヤー</h1>
    <h2 class="subtitle">Interactive Video Player</h2>
    
    <div class="video-pulse" id="videoPulse"></div>
    <div class="video-wrapper">
      <video id="video" src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"></video>
      <div class="controls">
        <div class="control-row">
          <button class="control-button" id="playButton">Play</button>
          <div class="progress" id="progressBar">
            <div class="progress-bar" id="progress"></div>
            <!-- Timestamp markers will be added here dynamically -->
          </div>
          <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
        </div>
        <div class="control-row">
          <div class="volume-container">
            <button class="control-button" id="muteButton">🔊</button>
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1">
          </div>
          <select class="speed-select" id="speedSelect">
            <option value="0.5">0.5x</option>
            <option value="0.75">0.75x</option>
            <option value="1" selected>1x</option>
            <option value="1.25">1.25x</option>
            <option value="1.5">1.5x</option>
            <option value="2">2x</option>
          </select>
          <button class="control-button" id="fullscreenButton">Fullscreen</button>
        </div>
      </div>
    </div>

    <!-- Mini-map for video navigation -->
    <div class="mini-map">
      <div class="mini-map-progress" id="miniMapProgress"></div>
      <div class="mini-map-thumbnail" id="miniMapThumbnail"></div>
      <div class="mini-map-sections" id="miniMapSections"></div>
    </div>

    <!-- Comments Section -->
    <div class="comments-container">
      <div class="comments-title">
        <span>コメント (Comments)</span>
        <button class="control-button" id="addTimestampComment">Add Comment at Current Time</button>
      </div>
      <div class="comment-form">
        <input type="text" class="comment-input" id="commentInput" placeholder="Enter your comment...">
        <button class="control-button" id="submitComment">Submit</button>
      </div>
      <div class="comment-list" id="commentList">
        <!-- Comments will be added here dynamically -->
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Loading screen
      const loadingScreen = document.getElementById('loadingScreen');
      
      // Initialize video controls
      const video = document.getElementById('video');
      const playButton = document.getElementById('playButton');
      const fullscreenButton = document.getElementById('fullscreenButton');
      const progressBar = document.getElementById('progressBar');
      const progress = document.getElementById('progress');
      const timeDisplay = document.getElementById('timeDisplay');
      const muteButton = document.getElementById('muteButton');
      const volumeSlider = document.getElementById('volumeSlider');
      const speedSelect = document.getElementById('speedSelect');
      
      // Comments elements
      const commentInput = document.getElementById('commentInput');
      const submitComment = document.getElementById('submitComment');
      const commentList = document.getElementById('commentList');
      const addTimestampComment = document.getElementById('addTimestampComment');
      
      // Comments array to store all comments
      let comments = [];
      
      // Format time to MM:SS
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        seconds = Math.floor(seconds % 60);
        return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
      }
      
      // Play/Pause button
      playButton.addEventListener('click', function() {
        if (video.paused) {
          video.play();
          playButton.textContent = 'Pause';
        } else {
          video.pause();
          playButton.textContent = 'Play';
        }
      });
      
      // Fullscreen button
      fullscreenButton.addEventListener('click', function() {
        if (video.requestFullscreen) {
          video.requestFullscreen();
        } else if (video.webkitRequestFullscreen) {
          video.webkitRequestFullscreen();
        } else if (video.msRequestFullscreen) {
          video.msRequestFullscreen();
        }
      });
      
      // Progress bar
      video.addEventListener('timeupdate', function() {
        const percentage = (video.currentTime / video.duration) * 100;
        progress.style.width = percentage + '%';
        timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
      });
      
      // Click on progress bar
      progressBar.addEventListener('click', function(e) {
        const pos = (e.pageX - this.offsetLeft) / this.offsetWidth;
        video.currentTime = pos * video.duration;
      });
      
      // Volume controls
      muteButton.addEventListener('click', function() {
        video.muted = !video.muted;
        if (video.muted) {
          muteButton.textContent = '🔇';
          volumeSlider.value = 0;
        } else {
          muteButton.textContent = '🔊';
          volumeSlider.value = video.volume;
        }
      });
      
      volumeSlider.addEventListener('input', function() {
        video.volume = this.value;
        video.muted = (this.value === 0);
        muteButton.textContent = (this.value === 0) ? '🔇' : '🔊';
      });
      
      // Playback speed
      speedSelect.addEventListener('change', function() {
        video.playbackRate = this.value;
      });
      
      // Add comment with timestamp
      function addComment(text, timestamp = null) {
        if (!text.trim()) return;
        
        const time = timestamp !== null ? timestamp : video.currentTime;
        const comment = {
          text: text,
          timestamp: time,
          id: Date.now()
        };
        
        comments.push(comment);
        renderComments();
        addTimestampMarker(comment);
        commentInput.value = '';
      }
      
      // Add timestamp marker to progress bar
      function addTimestampMarker(comment) {
        const marker = document.createElement('div');
        marker.className = 'timestamp-marker';
        const position = (comment.timestamp / video.duration) * 100;
        marker.style.left = `${position}%`;
        marker.title = `${formatTime(comment.timestamp)}: ${comment.text}`;
        marker.dataset.timestamp = comment.timestamp;
        
        marker.addEventListener('click', function() {
          video.currentTime = comment.timestamp;
        });
        
        progressBar.appendChild(marker);
      }
      
      // Render all comments
      function renderComments() {
        // Sort comments by timestamp
        comments.sort((a, b) => a.timestamp - b.timestamp);
        
        // Clear existing comments
        commentList.innerHTML = '';
        
        // Add all comments to the list
        comments.forEach(comment => {
          const commentElement = document.createElement('div');
          commentElement.className = 'comment-item';
          commentElement.innerHTML = `
            <span class="comment-timestamp" data-timestamp="${comment.timestamp}">${formatTime(comment.timestamp)}</span>
            <span>${comment.text}</span>
          `;
          
          // Add click event to timestamp
          commentElement.querySelector('.comment-timestamp').addEventListener('click', function() {
            video.currentTime = comment.timestamp;
          });
          
          commentList.appendChild(commentElement);
        });
      }
      
      // Event listeners for comments
      submitComment.addEventListener('click', function() {
        addComment(commentInput.value);
      });
      
      addTimestampComment.addEventListener('click', function() {
        commentInput.focus();
        commentInput.placeholder = `Comment at ${formatTime(video.currentTime)}...`;
      });
      
      commentInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addComment(this.value);
        }
      });
      
      // Add some sample comments
      setTimeout(() => {
        addComment("The animation starts here!", 5);
        addComment("Look at that cute bunny!", 10);
        addComment("This scene is so peaceful", 30);
      }, 1000);
      
      // Initialize our enhanced Japanese characters immediately
      function initializeBackgroundElements() {
        // Generate floating kanji
        const kanjiContainer = document.getElementById('kanjiContainer');
        
        // Extended array of Japanese characters
        const kanji = [
          '忍', '術', '神', '龍', '魔', '法', '気', '剣', '道', '陰', '陽', '風', '火', '水', 
          '地', '天', '空', '雷', '光', '闇', '桜', '月', '星', '霊', '鬼', '刀', '雪', '血',
          '戦', '命', '心', '力', '炎', '氷', '雲', '鋼', '夢', '幻', '魂', '弓', '矢', '盾',
          '絆', '技', '音', '影', '花', '狐', '狼', '竜', '虎', '獣'
        ];
        
        // Anime-specific terms
        const animeTerms = [
          '忍者', '侍', '武士', '魔法', '妖怪', '結界', '術式', '呪文', '召喚', '必殺技',
          '変身', '幻術', '妖術', '結印', '封印', '解放', '奥義', '発動', '覚醒', '絶技',
          '魔王', '勇者', '魔女', '巫女', '英雄', '鬼神', '守護', '破壊', '再生', '不死'
        ];
        
        // Clear any existing kanji
        kanjiContainer.innerHTML = '';
        
        // Generate 120 floating kanji (increased from 30)
        for (let i = 0; i < 120; i++) {
          const element = document.createElement('div');
          const isAnimeTerm = Math.random() > 0.7; // 30% chance to be an anime term
          
          if (isAnimeTerm) {
            element.className = 'kanji-anime';
            element.textContent = animeTerms[Math.floor(Math.random() * animeTerms.length)];
            element.style.animationDuration = (5 + Math.random() * 10) + 's';
            element.style.animationDelay = (-Math.random() * 10) + 's';
            element.style.fontSize = (2 + Math.random() * 3) + 'rem';
          } else {
            element.className = 'kanji';
            element.textContent = kanji[Math.floor(Math.random() * kanji.length)];
            element.style.animationDuration = (3 + Math.random() * 7) + 's';
            element.style.animationDelay = (-Math.random() * 5) + 's';
            element.style.fontSize = (3 + Math.random() * 6) + 'rem';
            element.style.animation = `float ${3 + Math.random() * 5}s ease-in-out infinite, intenseFire ${1 + Math.random() * 2}s infinite alternate`;
          }
          
          // Common properties
          element.style.left = Math.random() * 100 + '%';
          element.style.top = Math.random() * 100 + '%';
          element.style.opacity = 0.1 + Math.random() * 0.5;
          element.style.zIndex = Math.floor(parseInt(element.style.fontSize));
          
          kanjiContainer.appendChild(element);
        }
      }
      
      // Call immediately - don't wait for timeout
      initializeBackgroundElements();
      
      // Generate sakura petals
      const sakuraContainer = document.getElementById('sakuraContainer');
      
      for (let i = 0; i < 40; i++) {
        const sakura = document.createElement('div');
        sakura.className = 'sakura';
        sakura.style.left = Math.random() * 100 + '%';
        sakura.style.top = (-10 - Math.random() * 10) + 'px';
        sakura.style.width = (6 + Math.random() * 8) + 'px';
        sakura.style.height = (6 + Math.random() * 8) + 'px';
        sakura.style.animationDuration = (7 + Math.random() * 10) + 's';
        sakura.style.animationDelay = (-Math.random() * 10) + 's';
        sakura.style.transform = 'rotate(' + (Math.random() * 360) + 'deg)';
        sakuraContainer.appendChild(sakura);
      }

      // Hide loading screen after everything is loaded
      window.addEventListener('load', function() {
        setTimeout(() => {
          loadingScreen.style.opacity = 0;
          setTimeout(() => {
            loadingScreen.style.display = 'none';
          }, 500);
        }, 1500);
      });

      // If video metadata is loaded, we can also hide the loading screen
      video.addEventListener('loadedmetadata', function() {
        setTimeout(() => {
          loadingScreen.style.opacity = 0;
          setTimeout(() => {
            loadingScreen.style.display = 'none';
          }, 500);
        }, 1500);
      });

      // Fallback for loading screen
      setTimeout(() => {
        loadingScreen.style.opacity = 0;
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 500);
      }, 3000);

      // After initializing video controls
      const miniMapProgress = document.getElementById('miniMapProgress');
      const miniMapThumbnail = document.getElementById('miniMapThumbnail');
      const miniMapSections = document.getElementById('miniMapSections');
      
      // Create mini-map sections
      const sectionCount = 10;
      for (let i = 0; i < sectionCount; i++) {
        const section = document.createElement('div');
        section.className = 'mini-map-section';
        section.addEventListener('click', function() {
          const position = (i + 0.5) / sectionCount;
          video.currentTime = position * video.duration;
        });
        
        section.addEventListener('mouseover', function(e) {
          const position = (i + 0.5) / sectionCount;
          const time = position * video.duration;
          miniMapThumbnail.style.display = 'block';
          miniMapThumbnail.style.left = `${e.pageX}px`;
          miniMapThumbnail.textContent = formatTime(time);
        });
        
        section.addEventListener('mouseout', function() {
          miniMapThumbnail.style.display = 'none';
        });
        
        section.addEventListener('mousemove', function(e) {
          miniMapThumbnail.style.left = `${e.pageX}px`;
        });
        
        miniMapSections.appendChild(section);
      }
      
      // Update mini-map progress with video time
      video.addEventListener('timeupdate', function() {
        const percentage = (video.currentTime / video.duration) * 100;
        miniMapProgress.style.width = percentage + '%';
      });

      // After other initializations
      // Settings panel
      const settingsButton = document.getElementById('settingsButton');
      const settingsPanel = document.getElementById('settingsPanel');
      const bgToggle = document.getElementById('bgToggle');
      const autoplayToggle = document.getElementById('autoplayToggle');
      
      // Toggle settings panel
      settingsButton.addEventListener('click', function() {
        settingsPanel.classList.toggle('visible');
      });
      
      // Background toggle
      bgToggle.addEventListener('change', function() {
        if (this.checked) {
          document.body.classList.add('bg-image');
        } else {
          document.body.classList.remove('bg-image');
        }
      });
      
      // Autoplay toggle
      autoplayToggle.addEventListener('change', function() {
        if (this.checked) {
          video.autoplay = true;
          if (video.paused) {
            video.play();
            playButton.textContent = 'Pause';
          }
        } else {
          video.autoplay = false;
        }
      });

      // After settings panel initialization
      // Keyboard shortcuts
      const keyboardShortcuts = document.getElementById('keyboardShortcuts');
      let keyboardShortcutsVisible = false;
      
      // Toggle keyboard shortcuts panel
      function toggleKeyboardShortcuts() {
        keyboardShortcutsVisible = !keyboardShortcutsVisible;
        if (keyboardShortcutsVisible) {
          keyboardShortcuts.classList.add('visible');
        } else {
          keyboardShortcuts.classList.remove('visible');
        }
      }
      
      // Show keyboard shortcuts initially and hide after 5 seconds
      toggleKeyboardShortcuts();
      setTimeout(() => {
        if (keyboardShortcutsVisible) {
          toggleKeyboardShortcuts();
        }
      }, 5000);
      
      // Keyboard controls
      document.addEventListener('keydown', function(e) {
        // Don't trigger shortcuts if typing in a text field
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
          return;
        }
        
        switch(e.key) {
          case ' ':  // Space
            if (video.paused) {
              video.play();
              playButton.textContent = 'Pause';
            } else {
              video.pause();
              playButton.textContent = 'Play';
            }
            e.preventDefault();
            break;
            
          case 'f':  // Fullscreen
          case 'F':
            if (video.requestFullscreen) {
              video.requestFullscreen();
            } else if (video.webkitRequestFullscreen) {
              video.webkitRequestFullscreen();
            } else if (video.msRequestFullscreen) {
              video.msRequestFullscreen();
            }
            e.preventDefault();
            break;
            
          case 'm':  // Mute
          case 'M':
            video.muted = !video.muted;
            muteButton.textContent = video.muted ? '🔇' : '🔊';
            volumeSlider.value = video.muted ? 0 : video.volume;
            e.preventDefault();
            break;
            
          case 'ArrowLeft':  // Rewind 10 seconds
            video.currentTime = Math.max(0, video.currentTime - 10);
            e.preventDefault();
            break;
            
          case 'ArrowRight':  // Forward 10 seconds
            video.currentTime = Math.min(video.duration, video.currentTime + 10);
            e.preventDefault();
            break;
            
          case 'ArrowUp':  // Volume up
            video.volume = Math.min(1, video.volume + 0.1);
            volumeSlider.value = video.volume;
            video.muted = false;
            muteButton.textContent = '🔊';
            e.preventDefault();
            break;
            
          case 'ArrowDown':  // Volume down
            video.volume = Math.max(0, video.volume - 0.1);
            volumeSlider.value = video.volume;
            if (video.volume === 0) {
              video.muted = true;
              muteButton.textContent = '🔇';
            }
            e.preventDefault();
            break;
            
          case 'k':  // Toggle keyboard shortcuts
          case 'K':
            toggleKeyboardShortcuts();
            e.preventDefault();
            break;
        }
      });
    });
  </script>
</body>
</html> 